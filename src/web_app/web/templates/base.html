<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="https://i.imgur.com/lRDsnib.png">
    <meta charset="UTF-8">
    <title>Infobot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/16.6.3/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/16.6.3/umd/react-dom.production.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/js/bootstrap-select.min.js"></script>
</head>
<body class="app-background">
    {% set options = ['users', 'channels', 'reactions'] %}
    <div class="nav-bar">
        <nav class="navbar navbar-dark bg-dark">
            <a class="navbar-brand" href="/ui/home">
                <img src="https://i.imgur.com/lRDsnib.png" width="30" height="30" class="d-inline-block align-top" alt="">
                Infobot
            </a>
            <div class="nav-bar-buttons">
                <button type="button" class="btn btn-dark" onclick="home()">Home</button>
                <button type="button" class="btn btn-dark" onclick="course()">Courses</button>
                <button type="button" class="btn btn-dark" onclick="reminder()">Reminders</button>
                <button type="button" class="btn btn-dark" onclick="reaction()">Reactions</button>
                <button class="btn btn-dark" id="navbarDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  Admin
                <div id="admin-dropdown" class="dropdown-menu" aria-labelledby="navbarDropdown" style="margin-left: 23rem; width: 13rem;">
                    {% for option in options %}
                        <a class="dropdown-item" onclick='scan("{{option}}")'>
                        Scan for {{option}}.
                        <div style="margin-top: 3px;" id="scan-{{option}}-spinner" class="spinner-border text-primary spinner-border-sm float-right" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <svg id="scan-{{option}}-error" width="1em" height="1em" style="float: right; margin-top: 3px;" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                        <svg id="scan-{{option}}-success" width="1em" height="1em" style="float: right; margin-top: 3px;" viewBox="0 0 16 16" class="bi bi-check-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path fill-rule="evenodd" d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z"/>
                        </svg>
                    </a>
                    {% endfor %}
                <div class="dropdown-divider"></div>
                    <a class="dropdown-item" onclick="completeScan()">
                        Complete scan
                        <div style="margin-top: 3px;" id="scan-complete-spinner" class="spinner-border text-primary spinner-border-sm float-right" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                        <svg id="scan-complete-error" width="1em" height="1em" style="float: right; margin-top: 3px;" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                        </svg>
                        <svg id="scan-complete-success" width="1em" height="1em" style="float: right; margin-top: 3px;" viewBox="0 0 16 16" class="bi bi-check-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                            <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path fill-rule="evenodd" d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z"/>
                        </svg>
                    </a>
                </div>
                </button>
            </div>
        </nav>
    </div>
    {% block content %}
    {% endblock %}
</body>
</html>
<script>
    function home() {
        window.location.href = '/ui/home';
    }
    function course() {
        window.location.href = '/ui/course';
    }
    function reaction() {
        window.location.href = '/ui/reaction';
    }
    function reminder() {
        window.location.href = '/ui/reminder';
    }
</script>
<script>

    const SCAN_URL = '/scan/';
    let completeScanFlag = false;
    const LAST_OPTION = 'reactions';
    const OPTION_CLICKS = {'users': false, 'channels': false, 'reactions': false, 'complete': false};

    $(document).ready(function(){
        completeScanFlag = false;
        const OPTIONS = ['users', 'channels', 'reactions', 'complete']
        OPTIONS.forEach(element => {
            $('#scan-' + element + '-spinner').toggle();
            $('#scan-' + element + '-error').hide();
            $('#scan-' + element + '-success').hide();
        })
    });

    $("#admin-dropdown").click(function(e){
        e.stopPropagation();
    })

    function toggleSpinners(resource) {
        $('#scan-' + resource + '-spinner').toggle();
    }

    function scan(resource) {
        if (OPTION_CLICKS[resource] === true) return
        else OPTION_CLICKS[resource] = true
        toggleSpinners(resource);
        $.ajax({
            url  : SCAN_URL + resource,
            type : 'get',
            statusCode: {
                500: function () {
                    toggleSpinners(resource);
                    $('#scan-' + resource + '-error').show();
                    if(completeScanFlag && resource === LAST_OPTION) {
                        toggleSpinners('complete');
                        $('#scan-complete-error').show();
                    }
                },
                200: function () {
                    toggleSpinners(resource);
                    $('#scan-' + resource + '-success').show();
                    if(completeScanFlag && resource === LAST_OPTION) {
                        toggleSpinners('complete');
                        $('#scan-complete-success').show();
                    }
                }
            }
        });
    }

    function completeScan() {
        if (OPTION_CLICKS['complete'] === true) return
        else OPTION_CLICKS['complete'] = true
        completeScanFlag = true;
        $('#scan-complete-spinner').toggle();
        ['users', 'channels', 'reactions'].forEach(element => {
            scan(element);
        });
    }
</script>